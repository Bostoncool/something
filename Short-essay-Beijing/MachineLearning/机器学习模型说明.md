# 北京PM2.5浓度预测 - 机器学习模型

## 概述

本目录包含基于气象变量预测PM2.5浓度的机器学习基线模型，使用多元线性回归(MLR)和广义加性模型(GAM)作为基准方法。

## 模型列表

### 1. MLR_GAM_Baseline.py - 线性基线模型

这是预测PM2.5浓度的线性基线模型，包括：
- **多元线性回归 (Multiple Linear Regression, MLR)**
- **Ridge回归 (L2正则化)**
- **广义加性模型 (Generalized Additive Model, GAM)**

## 数据来源

### 气象数据
- 来源：ERA5再分析数据
- 时间范围：2015-01-01 至 2024-12-31
- 空间范围：北京地区 (39-41°N, 115-117°E)
- 时间分辨率：日均值

### 污染数据
- 来源：北京市空气质量监测站
- 污染物：PM2.5, PM10, SO2, NO2, CO, O3
- 时间分辨率：日均值

## 特征选择

基于相关性分析结果（Pearson、Spearman、Kendall相关性），选择与PM2.5浓度相关性较强的气象变量：

### 主要特征

1. **d2m** (露点温度) - 相关性最强
   - 反映空气湿度，影响污染物的吸湿性和沉降

2. **t2m** (2米温度)
   - 影响大气稳定度和对流活动

3. **wind_speed_10m** (10米风速)
   - 从u10和v10计算得到
   - 影响污染物的水平扩散

4. **tcwv** (总柱水汽)
   - 反映大气中的水汽含量，影响能见度和污染物分布

5. **tp** (降水量)
   - 降水对污染物有清除作用

6. **blh** (边界层高度)
   - 影响污染物的垂直扩散能力

7. **sp** (地面气压)
   - 反映大气环流形势

8. **str** (表面热辐射)
   - 反映地表温度和辐射平衡

9. **tisr** (太阳辐射)
   - 影响光化学反应和大气稳定度

10. **时间特征** (month, season)
    - 捕捉季节性变化

## 模型说明

### 1. 多元线性回归 (MLR)

最简单的线性模型，假设PM2.5浓度与气象变量之间存在线性关系：

```
PM2.5 = β₀ + β₁·d2m + β₂·t2m + β₃·wind_speed + ... + ε
```

**优点：**
- 简单直观，易于解释
- 计算效率高
- 可以直接看到每个特征的贡献

**缺点：**
- 只能捕捉线性关系
- 对多重共线性敏感

### 2. Ridge回归

在MLR基础上加入L2正则化，防止过拟合：

```
Loss = MSE + α·||β||²
```

**优点：**
- 缓解多重共线性问题
- 防止过拟合
- 所有特征都会保留（不会变为0）

**缺点：**
- 需要调整正则化参数α
- 仍然只能捕捉线性关系

### 3. 广义加性模型 (GAM)

允许特征与目标变量之间存在非线性关系：

```
PM2.5 = β₀ + s₁(d2m) + s₂(t2m) + s₃(wind_speed) + ... + ε
```

其中s(·)是平滑样条函数

**优点：**
- 可以捕捉非线性关系
- 保持一定的可解释性
- 每个特征的影响可以单独可视化

**缺点：**
- 计算复杂度较高
- 需要选择样条的自由度
- 可能过拟合

## 使用方法

### 环境准备

```bash
pip install pandas numpy matplotlib seaborn scikit-learn scipy pygam
```

### 运行模型

```bash
python MLR_GAM_Baseline.py
```

### 输出文件

程序会生成以下文件：

**数据文件：**
1. `model_performance.csv` - 各模型的性能指标
2. `predictions.csv` - 测试集上的预测结果
3. `feature_importance.csv` - 特征重要性（系数值）

**可视化图表：**
1. `prediction_scatter.png` - 预测值vs实际值散点图
2. `prediction_timeseries.png` - 时间序列预测对比
3. `residuals_analysis.png` - 残差分析图
4. `feature_importance.png` - 特征重要性条形图
5. `model_comparison.png` - 模型性能对比

## 评估指标

### R² Score (决定系数)
- 范围：-∞ 到 1
- 值越接近1表示模型拟合越好
- 0表示模型与均值预测相当
- 负值表示模型还不如均值预测

### RMSE (均方根误差)
```
RMSE = √(Σ(y_true - y_pred)² / n)
```
- 单位与PM2.5浓度相同 (μg/m³)
- 值越小越好
- 对大误差更敏感

### MAE (平均绝对误差)
```
MAE = Σ|y_true - y_pred| / n
```
- 单位与PM2.5浓度相同 (μg/m³)
- 值越小越好
- 对所有误差一视同仁

## 数据集划分

- **训练集**：前80%的数据（按时间顺序）
  - 用于模型训练
  
- **测试集**：后20%的数据
  - 用于评估模型性能
  - 模拟实际预测场景

## 模型改进方向

### 1. 特征工程
- 添加滞后特征（前几天的PM2.5浓度）
- 添加移动平均特征
- 添加更多时间特征（周末/工作日、节假日等）
- 特征交互项（如温度×湿度）

### 2. 非线性模型
- 随机森林 (Random Forest)
- 梯度提升树 (XGBoost, LightGBM)
- 支持向量回归 (SVR)
- 神经网络 (MLP)

### 3. 时间序列模型
- ARIMA/SARIMA
- LSTM/GRU
- Transformer

### 4. 集成学习
- 模型融合
- Stacking
- Blending

## 参考文献

1. Hastie, T., & Tibshirani, R. (1990). Generalized Additive Models.
2. Hoerl, A. E., & Kennard, R. W. (1970). Ridge Regression.
3. James, G., et al. (2013). An Introduction to Statistical Learning.

## 相关性分析结果总结

根据 `Preprocessing-Correlation` 目录中的分析：

### Pearson相关性（线性相关）
与PM2.5_mean最相关的变量：
- d2m_max: 0.102
- d2m_mean: 0.099
- tp_min: 0.098
- tcwv_max: 0.081

### Kendall相关性（秩相关，对异常值稳健）
与PM2.5_mean最相关的变量：
- d2m_min: 0.102
- d2m_max: 0.098
- d2m_mean: 0.090

### 主要发现
1. **露点温度(d2m)** 与PM2.5的相关性最强
2. **湿度相关变量(tcwv)** 有重要影响
3. **风速** 影响污染物扩散
4. **温度** 影响大气稳定度
5. 相关性整体较弱（<0.15），说明PM2.5受多种因素综合影响

## 注意事项

1. **数据路径**：请根据实际情况修改数据路径
2. **计算时间**：完整运行可能需要10-30分钟
3. **内存需求**：建议至少8GB RAM
4. **GAM模型**：如果未安装pygam，会自动跳过GAM模型

## 联系方式

如有问题，请参考：
- 相关性分析：`../Preprocessing-Correlation/`
- 深度学习模型：`../DeepLearning/`

